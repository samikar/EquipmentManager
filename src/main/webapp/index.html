<!DOCTYPE html>
<html>

<head>
  <title>Take Equipment</title>
  <meta name = "viewport" content = "width = device-width, initial-scale = 1.0">

  <!-- Bootstrap -->
  <link href = "css/bootstrap.min.css" rel = "stylesheet">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

<!--[if lt IE 9]>
<script src = "https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src = "https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
<![endif]-->

</head>

<body>
  <!-- Fixed navbar -->
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Equipment manager</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="index.html">Take</a></li>
          <li><a href="return.html">Return</a></li>
          <li><a href="list.html">Equipment list</a></li>
          <li><a href="charts.html">Charts</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>

  <div class="container">
    <br><br><br>
    <div class="row">
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary active">
            <input type="radio" name="rad_type" id="option1" value="0" autocomplete="off" checked>Take
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="rad_type" id="option2" value="1" autocomplete="off">Calibration
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="rad_type" id="option3" value="2" autocomplete="off">Maintenance
          </label>
        </div>
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="input-group mb-3">
          <div class="input-group input-group-md">
            <span class="input-group-addon">Employee ID&nbsp;&nbsp;</span>
            <input type="text" class="form-control" placeholder="Your ID" id="txt_employeeId">
          </div>
          <br>
          <div class="input-group mb-3">
          <span class="input-group-addon">Serial number</span>
          <input type="text" class="form-control" placeholder="..." id="txt_serial">
        </div>
        </div>
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">    
        <button class="btn btn-primary mb-2" id="btn_submit">Submit</button>
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col-lg-12 col-md-12 cold-sm-12 col-xs-12">
        <div id="status" class="alert hidden"></div>    
      </div>
    </div>
  </div> <!-- /container -->

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <!--script src = "https://code.jquery.com/jquery.js"></script-->
  <script src = "js/jquery-3.2.1.js"></script>

  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src = "js/bootstrap.min.js"></script>

  <script>
    $(document).ready(function(){
      $("#btn_submit").click(function(){
        takeEquipment();
      });

      $(document).keypress(function(e) {
        if(e.which == 13) {
          takeEquipment();
        }
      });

      function takeEquipment() {
        var employeeId = $('#txt_employeeId').val();
        var serial = $('#txt_serial').val();
        var reservationType = $('input[name=rad_type]:checked').val();
        $.post("rest/take",
        {
          employeeId: employeeId,
          serial: serial,
          reservationType: reservationType
        },
        function(data){
          $('#txt_serial').val("");
          $('#txt_serial').focus();
          $("#status").removeClass('hidden');
          $("#status").removeClass('alert-danger');
          $("#status").addClass('alert-success');
          $('#status').text(data["equipment"]["serial"] + "/" +  data["equipment"]["name"] + " succesfully reserved.");
        })
        .done(function() {
        //alert( "second success" );
        })
        .fail(function(jqXHR, textStatus) {
          $('#txt_serial').val("");
          $("#status").addClass('alert-danger');
          $("#status").removeClass('hidden');
          $('#status').text("Error: " + jqXHR["responseJSON"]["message"]);       
        })
        .always(function() {
          //alert( "finished" );
        });
      }
    });
  </script>

</body>
</html>
